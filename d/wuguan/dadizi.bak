//Created by Zyu on k1-08-11
// dadizi.c 武馆大弟子

#include <ansi.h>
inherit NPC;

string ask_me();

#ifndef JOB_SERVER
#define JOB_SERVER "/clone/obj/job_server.c"
#endif

#define JOB_NAME "wuguan_volunteer"

int do_kill(string arg);
int do_volunteer();
int do_say(string arg);
int do_quit();
void end_volunteer(object, int);
void greeting(object);

int jobid = 1;

  if (JOB_SERVER->get_exp_limit(JOB_NAME) < 1) {
      JOB_SERVER->set_exp_limit(JOB_NAME, 500);
      JOB_SERVER->set_pot_limit(JOB_NAME, 200); //newbie job, more pot
  }
}
void create()
{
	set_name("李明", ({ "li ming", "li", "da dizi", "dizi" }));
	set("long", "他长得高头大马，非常健壮。\n");
	set("title", "武馆大弟子");
	set("nickname", HIG"离开武馆请找我"NOR);
	set("gender", "男性");
	set("age", 25);

	set_skill("unarmed", 120);
	set_skill("dodge", 130);
	set_skill("parry", 120);
	set_skill("stick", 120);
	set_skill("staff", 120);
	set_skill("sword", 120);
	set_skill("blade", 120);	
        set_temp("apply/attack", 800);
        set_temp("apply/defense", 800);
        set_temp("apply/damage", 500);


	set("combat_exp", 150000);
	set("shen_type", 1);
        set("inquiry", ([
                "离去" : (: ask_me :),
                "exit" : (: ask_me :),
                "出馆" : (: ask_me :),
                "leave" : (: ask_me :),
        ]));

	setup();

	switch( random(4) )
        {
                case 0:
                       carry_object("/d/city/obj/gangjian")->wield();
                       break;
                case 1:
                       carry_object("/d/city/obj/gangdao")->wield();
                       break;
                case 2:
                       carry_object("/d/xingxiu/obj/gangzhang")->wield();
                       break;
                case 3:
                       carry_object("/d/city/obj/zhubang")->wield();
		       break;		
	}
}

string ask_me()
{
	object me = this_player();
	string nick = (me->query("gender")=="男性")?"小兄弟":"小姑娘";
	string reply_fail = nick + "经验不足，还是回去再锻炼锻炼吧。";
	string yesno = nick + "确定要离开吗？(确定了请输入：「是」或 「yes」)";

	if ( me->query("combat_exp") < 7500 )
	{
		command("angry " + me->query("id"));
		return reply_fail;
	}

	command("bow " + me->query("id"));

	add_action("do_nod", "是");
	add_action("do_nod", "yes");
	return yesno;
}

int do_nod()
{
	object li = this_object();
	object me = this_player();
	object room;
	string nick = (me->query("gender")=="男性")?"小兄弟":"小姑娘";
	string wait = nick + "，稍等片刻，我去去就来。";

	command(":)");
	command("nod " + me->query("id"));
	command("say " + wait);

	if ( !(room = find_object("/d/wuguan/test")) )
		room = load_object("/d/wuguan/test");

	move(room);
	message_vision("\n李明看了看时辰，快步离开了。\n", me);

	remove_call_out("ready_go");
	call_out("ready_go", 2+random(3), me, nick);

	return 1;
}

void ready_go(object me, string nick, string ready)
{
	move(environment(me));

	ready = nick + "，杨风就是你的考官了，他会告诉你具体事宜的。";

	command("bow " + me->query("id"));
	command("say " + nick + ",请跟我来。");

	message("vision",
		"\n李明拉住"+me->name()+"的手，几个闪身就不见了。\n",
		environment(me), ({me}) );
	move("/d/wuguan/test");
	me->move("/d/wuguan/test");
	tell_object(me,"\n李明拉住你的手，几个闪身就到了你从未到过的地方。\n");

	command("smile");
	command("say " + ready);
	command("wave" + me->query("id"));
	move("/d/wuguan/damen");

	return;
}