
// 苏梦馨(Athena) 
// OBJ：/u/athena/obj/qupu.c
 
#include <ansi.h>
#include <command.h>
inherit ITEM;

mapping *qupu = ({
 ([ "name":"yuanyuan_qu",
           "context": ({           
CYN"         
                        《圆圆曲》                \n" NOR,
CYN"              鼎湖当日弃人间，破敌收京下玉关。\n" NOR,
CYN"              恸哭六军俱缟素，冲冠一怒为红颜。\n" NOR,
CYN"              红颜流落非吾恋，逆贼天亡自荒宴。\n" NOR,
CYN"              电扫黄巾定黑山，哭罢君亲再相见。\n" NOR,
CYN"              相见初经田窦家，侯门歌舞出如花。\n" NOR,
CYN"              许将戚里空侯伎，等取将军油壁车。\n" NOR,
CYN"              家本姑苏浣花里，圆圆小字妖罗绮。\n" NOR,
CYN"              梦向夫差苑里游，宫娥拥入君王起。\n" NOR,
CYN"              前身合是采莲人，门前一片横塘水。\n" NOR,
CYN"              横塘双桨去如飞，何处豪家强载归？\n" NOR,
CYN"              此际岂知非薄命，此时只有泪沾衣。\n" NOR,
CYN"              熏天意气连宫掖，明眸皓齿无人惜。\n" NOR,
CYN"              夺归永巷闭良家，教就新声倾座客。\n" NOR,
CYN"              座客飞觞红日莫，一曲哀弦向谁诉？\n" NOR,
CYN"              白皙通侯最少年，拣取花枝屡回顾。\n" NOR,
CYN"              早携娇鸟出樊笼，待得银河几时渡？\n" NOR,
CYN"              恨杀军书抵死催，苦留后约将人误。\n" NOR,
CYN"              相约恩深相见难，一朝蚁贼满长安。\n" NOR,
CYN"              可怜思妇楼头柳，认作天边粉絮看。\n" NOR,
CYN"              便索绿珠围内第，强呼绛树出雕栏。\n" NOR,
CYN"              若非将士全师胜，争得蛾眉匹马还。\n" NOR,
CYN"              蛾眉马上传呼进，云鬟不整惊魂定。\n" NOR,
CYN"              蜡烛迎来在战场，啼妆满面残红印。\n" NOR,
CYN"              专征萧鼓向秦川，金牛道上车千乘。\n" NOR,
CYN"              斜谷云深起画楼，散关月落开妆镜。\n" NOR,
CYN"              传来消息满红乡，乌桕红经十度霜。\n" NOR,
CYN"              都曲妓师怜尚在，浣沙女伴忆同行。\n" NOR,
CYN"              旧巢共是衔泥燕，飞上枝头变凤凰。\n" NOR,
CYN"              长向尊前悲老大，有人夫婿擅侯王。\n" NOR,
CYN"              当时只受声名累，贵戚名豪尽延致。\n" NOR,
CYN"              一斛珠连万斛愁，关山漂泊腰支细。\n" NOR,
CYN"              错怨狂风扬落花，无边春色来天地。\n" NOR,
CYN"              尝闻倾国与倾城，翻使周郎受重名。\n" NOR,
CYN"              妻子岂应关大计，英雄无奈是多情。\n" NOR,
CYN"              全家白骨成灰土，一代红妆照汗青。\n" NOR,
CYN"              君不见\n" NOR,
CYN"              馆娃初起鸳鸯宿，越女如花看不足。\n" NOR,
CYN"              香径尘生鸟自啼，渫廊人去苔空绿。\n" NOR,        
CYN"              换羽移宫万里愁，珠歌翠舞古梁州。\n" NOR,
CYN"              为君别唱吴宫曲，汉水东南日夜流。\n" NOR
})]),

([ "name":"wanghai_chao",
           "context": ({
HIB" 
                        《望海潮》             \n" NOR,
HIB"              东南形胜  江湖都会  钱塘自古繁华  \n" NOR,
HIB"              烟柳画桥  风帘翠幕  参差十万人家  \n" NOR,
HIB"              云树绕堤沙  怒涛卷霜雪            \n" NOR,
HIB"              天堑无涯  市列珠玑                \n" NOR,
HIB"              户盈罗倚竞豪者                    \n" NOR,
HIB"              重湖叠献清佳  有三秋桂子  十里荷花\n" NOR,
HIB"              羌管弄晴  菱歌泛夜  嬉嬉钓叟莲娃  \n" NOR,
HIB"              千骑拥高牙  乘醉听箫枝            \n" NOR,
HIB"              吟卖烟霞  异日图将好景  归去凤池夸\n" NOR
})]),

([ "name":"wenshi_jian",
           "context": ({
HIY" 
                    《问世间  情为何物》         \n" NOR,
HIY"              问世间  情为何物  直教生死相许    \n" NOR,
HIY"              天南地北双飞客  老翅几回寒暑      \n" NOR,
HIY"              欢乐趣  离别苦  就中更有痴儿女    \n" NOR,
HIY"              君应有语  渺万里层云              \n" NOR,
HIY"              千山幕景  只影为谁去              \n" NOR,
HIY"              横汾路  寂寞当年萧鼓  荒烟依旧平楚\n" NOR,
HIY"              招魂楚些何磋及  山鬼自啼风雨      \n" NOR,
HIY"              天也妒  未信与  莺儿燕子俱黄土    \n" NOR,
HIY"              千秋万古  为留待骚人              \n" NOR,
HIY"              狂歌痛饮  来访雁丘处              \n" NOR
})]),


([ "name":"jiangcheng_zi",
           "context": ({
CYN" 
                《江城子》                      \n" NOR,
CYN"              十年生死两茫茫。                  \n" NOR,
CYN"              不思量，自难忘。                  \n" NOR,
CYN"              千里孤坟，无处话凄凉。            \n" NOR,
CYN"              纵使相逢应不识，                  \n" NOR,
CYN"              尘满面，鬓如霜。                  \n" NOR,
CYN"              夜来幽梦忽还乡。                  \n" NOR,
CYN"              小轩窗，正梳妆。                  \n" NOR,
CYN"              相顾无言，惟有泪千行。            \n" NOR,
CYN"              明月夜，短松冈。                  \n" NOR,
})]),

([ "name":"dielian_hua",
           "context": ({
WHT"
                《蝶恋花》      \n"NOR,
WHT"              越女采莲秋水畔       \n"NOR,
WHT"              窄袖轻罗  暗露双金钏 \n"NOR,
WHT"              照影摘花花似面       \n"NOR,
WHT"              芳心只共丝争乱       \n"NOR,
WHT"              鸡尺溪头风浪晚       \n"NOR,
WHT"              雾重烟轻  不见来时伴 \n"NOR,
WHT"              隐隐歌声归棹远       \n"NOR,
WHT"              离愁引著江南岸       \n"NOR
})]),

([ "name":"bosi_xiaoqu",
           "context": ({
CYN"
                    《波斯小曲》          \n"NOR,
CYN"              世情推物理  人生贵适意\n"NOR,
CYN"              想人间造物搬兴废  吉藏凶  凶藏吉  富贵那能长富贵\n"NOR,
CYN"              日盈昃  月满亏蚀  地下东南  天高西北  天地尚无完体  \n"NOR,
CYN"              展放愁眉  休争闲气  今日容颜  老於昨日  古往今来  尽须如此\n"NOR,
CYN"              管他贤的愚的  贫的和富的  到头这一身  难逃那一日  \n"NOR,
CYN"              受用了一朝  一朝便宜\n"NOR,
CYN"              百岁光阴  七十者稀  急急流年  滔滔逝水\n"NOR
})]),

([ "name":"yinma_changcheng",
           "context": ({
HIC"
                  《饮马长城窟行》   \n"NOR,
HIC"              青青河边草，绵绵思远道。\n"NOR,
HIC"              远道不可思，宿昔梦见之。\n"NOR,
HIC"              梦见在我傍，忽焉在他乡。\n"NOR,
HIC"              他乡各异县，辗转不相见。\n"NOR,
HIC"              枯桑知天风，海水知天寒。\n"NOR,
HIC"              入门各自媚，谁肯相为言。\n"NOR,
HIC"              客从远方来，遗我双鲤鱼。\n"NOR,
HIC"              呼儿烹鲤鱼，中有尺素书。\n"NOR,
HIC"              长跪读素书，书中竟何如？\n"NOR,
HIC"              上言加餐饭，下言长相思。\n"NOR
})]),

([ "name":"chunjiang_huayueye",
           "context": ({
YEL"
                      《春江花月夜》               \n"NOR,
YEL"              春江潮水连海平，海上明月共潮生。\n"NOR,
YEL"              滟滟随波千万里，何处春江无月明。\n"NOR,
YEL"              江流宛转绕芳甸，月照花林皆似霰。\n"NOR,
YEL"              空里流霜不觉飞，汀上白沙看不见。\n"NOR,
YEL"              江天一色无纤尘，皎皎空中孤月轮。\n"NOR,
YEL"              江畔何人初见月？江月何年初照人？\n"NOR,
YEL"              人生代代无穷已，江月年年只相似。\n"NOR,
YEL"              不知江月待何人，但见长江送流水。\n"NOR,
YEL"              白云千载去悠悠，青风浦上不胜愁。\n"NOR,
YEL"              谁家今夜扁舟子？何处相思明月楼？\n"NOR,
YEL"              可怜楼上月徘徊，应照离人妆镜台。\n"NOR,
YEL"              玉户帘中卷不去，捣衣砧上拂还来。\n"NOR,
YEL"              此时相望不相闻，愿逐月华流照君。\n"NOR,
YEL"              鸿雁长飞光不度，鱼龙潜跃水成文。\n"NOR,
YEL"              昨夜闲潭梦落花，可怜春半不还家。\n"NOR,
YEL"              江水流春去欲尽，江潭落月复西斜。\n"NOR,
YEL"              斜月沉沉藏海雾，碣石潇湘无限路。\n"NOR,
YEL"              不知乘月几人归，落月摇情满江树。\n"NOR
})]),

([ "name":"jiangjin_jiu",
           "context": ({
HIY"
                 《将进酒》                    \n"NOR,
HIY"              君不见黄河之水天上来，奔流到海不复回。\n"NOR,
HIY"              君不见高堂明镜悲白发，朝如青丝暮成雪。\n"NOR,
HIY"              人生得意须尽欢，莫使金樽空对月。\n"NOR,
HIY"              天生我才必有用，千金散尽还复来。\n"NOR,
HIY"              烹羊宰牛且为乐；会须一饮三百杯。\n"NOR,
HIY"              岑夫子  丹丘生，将进酒，杯莫停。\n"NOR,
HIY"              与君歌一曲，请君为我倾耳听。\n"NOR,
HIY"              钟鼓馔玉不足贵，但愿长醉不复醒。\n"NOR,
HIY"              古来圣贤皆寂寞，惟有饮者留其名。\n"NOR,
HIY"              陈王昔时宴平乐，斗酒十千恣欢谑。\n"NOR,
HIY"              主人何为言少钱，径须沽取对君酌。\n"NOR,
HIY"              五花马  千金裘，呼儿将出换美酒。\n"NOR,
HIY"              与尔销万古愁。\n"NOR
})]),

([ "name":"xiaoao_jianghu",
           "context": ({
RED"
                  《笑傲江湖》              \n"NOR,
RED"              沧海一声笑 滔滔两岸潮        \n"NOR,
RED"              浮沉随浪 只记今朝            \n"NOR,
RED"              苍天笑                       \n"NOR, 
RED"              纷纷世上潮                   \n"NOR,
RED"              谁负谁胜出 天知晓            \n"NOR,
RED"              江山笑                       \n"NOR,
RED"              烟雨遥                       \n"NOR,
RED"              涛浪淘尽 红尘俗世几多娇      \n"NOR,
RED"              清风笑                       \n"NOR,
RED"              竟惹寂寥                     \n"NOR,
RED"              豪情还剩了一襟晚照           \n"NOR,
RED"              苍生笑                       \n"NOR,
RED"              不再寂寥                     \n"NOR,
RED"              豪情仍在 痴痴笑笑            \n"NOR
})]),

([ "name":"yu_meiren",
           "context": ({
CYN"
                     《虞美人》                  \n"NOR,
CYN"             春花秋月何时了。往事知多少。   \n"NOR,
CYN"             小楼昨夜又东风，故国不堪回首月明中。\n"NOR,
CYN"             雕栏玉砌应犹在，只是朱颜改，        \n"NOR,
CYN"             问君能有几多愁，恰似一江春水向东流。\n"NOR         
})]),

([ "name":"baixue_ge",
           "context": ({
WHT"
                《白雪歌送武判官回京》     \n"NOR,
WHT"             北风卷地白草折，胡天八月即飞雪，\n"NOR,
WHT"             忽如一夜春风来，千树万树梨花开，\n"NOR,
WHT"             散入珠廉湿罗幕，狐裘不暖锦衾薄。\n"NOR,
WHT"             将军角弓不得控，都护铁衣冷难着。\n"NOR,
WHT"             瀚海阑干白尺冰，愁云惨淡万里凝。\n"NOR,
WHT"             中军置酒饮归客，胡琴琵琶与羌笛。\n"NOR,
WHT"             纷纷暮雪下辕门，风挚红旗冻不翻。\n"NOR,
WHT"             轮台东门送君去，去时雪满天山路，\n"NOR,
WHT"             山回路转不见君，雪上空留马行处。\n"NOR           
})]),
});

void create()
{
        set_name(CYN "曲谱" NOR, ({"qu pu", "pu"}));
        set_weight(1000);
        if (clonep())
                set_default_object(__FILE__);
        else {
                set("unit", "册");
                set("long", "
一册裱钉精美的曲谱，你可以唱(chang)里面的曲子：

  《圆圆曲》(yuanyuan_qu)
  《江城子》(jiangcheng_zi)
  《望海潮》(wanghai_chao)
  《问世间  情为何物》(wenshi_jian)
  《蝶恋花》(dielian_hua)
  《波斯小曲》(bosi_xiaoqu)
  《春江花月夜》(chunjiang_huayueye)
  《饮马长城窟行》(yinma_changcheng)
  《将进酒》(jiangjin_jiu)
  《笑傲江湖》(xiaoao_jianghu)
  《白雪歌送武判官回京》(baixue_ge)
  《虞美人》(yu_meiren)
  
你如果觉得唱得不好，可以停(ting)下，再回去练练。
\n");
                set("value", 10000);
                set("material", "silk");
       }
       setup();
}

void init()
{
       add_action("do_sing", "chang");
       add_action("do_halt", "ting");
}
int do_halt()
{
       if (find_call_out("sing_stage") < 0) return 0;
       this_player()->delete_temp("qupu");
       message_vision(HIR"\n$N发现大家一脸痛苦的表情，尴尬地咳嗽了两声，停下了噪音。\n"NOR, this_player());
       remove_call_out("sing_stage");
       return 1;
}

int do_sing(string arg)
{
      object me, ob; 
      int i = sizeof(qupu);
      int stage;
      stage = 0;
      me = this_player();
      ob = this_object();
      if (find_call_out("sing_stage") >= 0) return notify_fail("你能同时唱两首曲子吗？\n");
      if(!arg) return notify_fail("你想唱什么？\n");
      while (i--) if (arg == qupu[i]["name"]) break;
      if (i<0) return notify_fail("曲谱里还没有你想唱的曲子。\n");
      if(me->is_busy())
      return notify_fail("你正忙着呢。\n");
      if(me->query_temp("qupu")) return notify_fail("你正在唱着呢。\n");
      if(me->query("gender") != "男性")
      message_vision(MAG"$N翻开$n"MAG"，起身盈盈一拜，然后站在台前慢声开始唱道：\n\n"NOR, me, ob);
      else message_vision(BLU"$N翻开$n"BLU"，盘膝坐下，将琵琶放在膝上，理弦调韵，拉唱起来：\n\n"NOR, me, ob);       
      call_out("sing_stage", 2, me, stage, i, sizeof(qupu[i]["context"]));
      return 1;
}

void sing_stage(object me, int stage, int i, int size)
{
     if(stage < size) {
     message_vision(qupu[i]["context"][stage], me);
     me->start_busy(1);
     call_out("sing_stage", 1, me, ++stage, i, size);
     }
     else {
     me->delete_temp("qupu");
     if(me->query("gender") != "男性") 
     message_vision(MAG"\n$N声调转高，唱完最后一字，歌声却依然曼长不绝，在空中来回荡漾。。。\n"NOR, me);
     else  message_vision(BLU"\n只听铮的一声，二胡声止歇，$N唱完一曲，站起身来，对在场各人点了个头。\n"NOR, me);    
     }
}
