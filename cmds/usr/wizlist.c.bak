// Code of Shenzhou
// wizlist.c
// by lisser 7-12-01

#include <ansi.h>
inherit F_CLEAN_UP;
#define RENWU "/adm/etc/renwu"
int main(object me, string arg)
{
	string *list, wiz, quest, w_class, class1, class2, class3, class4, wizname;
	mapping quests = ([ ]),wizstatus;
	mapping w_classes = ([ ]);
	object ob, user;
	int count, i, t, c1, c2, c3, c4;
/*	string *list, name;
	mapping wizstatus;
	object user;
	int j = 0;
	int i;*/

	write(CYN"\n\n【神州】开放站的目前的神仙有：\n"NOR);
	wizstatus = SECURITY_D->query_wizstatus();
	list = keys(wizstatus);
	if (file_size(RENWU))
	foreach(string str in explode(read_file(RENWU),"\n")){
	if( str[0]=='#' || sscanf(str, "%s %s %s", wiz, w_class, quest)==3 )
		{
		w_classes += ([ wiz : w_class ]);
		quests += ([ wiz : quest ]);
		}
	else if( str[0]=='#' || sscanf(str, "%s %s", wiz, w_class)==2 )
		{
		w_classes += ([ wiz : w_class ]);
		quests += ([ wiz : "nothing" ]);
		}
	else continue;
	}
	class1 = "";    class2 = "";
	class3 = "";    class4 = "";
	
	c1 = 0; c2 = 0; c3 = 0; c4 = 0;	
	count = 0;
	
	for( i=0; i<sizeof(list); i++)
	{
		foreach(wiz in list)
		{
			if(wiz_level(wiz) == i)
			{
				switch(w_classes[wiz])
				{
				case "GLB":
				c1++;
				count++;
				if( objectp(ob=find_player(wiz)) && me->visible(ob) )
                                        if(!ob->query("env/invisibility"))
							class1 += ((c1-1)%2?"":"\n")+HIG+wiz+NOR;
						else
							class1 += ((c1-1)%2?"":"\n")+HIY+wiz+NOR;
				else 
				class1 += ((c1-1)%2?"":"\n")+WHT+wiz+NOR;
				
				if( undefinedp(quests[wiz]) || quests[wiz]=="nothing" )
				class1 += "("HIW+"暂无任务"+NOR")\t\t\t";
				else if( strlen(quests[wiz])<31 )
				    class1 += "("YEL+quests[wiz]+NOR")\t\t\t";
				else class1 += "("YEL+quests[wiz]+NOR")\t\t";
				break;
				
				case "KFB":
				c2++;
				count++;
				if( objectp(ob=find_player(wiz)) && me->visible(ob) )
                                        if(!ob->query("env/invisibility"))
							class2 += ((c2-1)%2?"":"\n")+HIG+wiz+NOR;
						else
							class2 += ((c2-1)%2?"":"\n")+HIY+wiz+NOR;
				else
				class2 += ((c2-1)%2?"":"\n")+WHT+wiz+NOR;
				
				if( undefinedp(quests[wiz]) || quests[wiz]=="nothing" )
				class2 += "("HIW+"暂无任务"+NOR")\t\t\t";
				else if( strlen(quests[wiz])<31 )
				    class2 += "("YEL+quests[wiz]+NOR")\t\t\t";
				else class2 += "("YEL+quests[wiz]+NOR")\t\t";
				break;
				
				case "SWB":
				c3++;
				count++;
				if( objectp(ob=find_player(wiz)) && me->visible(ob) )
                                        if(!ob->query("env/invisibility"))
							class3 += ((c3-1)%2?"":"\n")+HIG+wiz+NOR;
						else
							class3 += ((c3-1)%2?"":"\n")+HIY+wiz+NOR;
				else
				class3 += ((c3-1)%2?"":"\n")+WHT+wiz+NOR;
				
				if( undefinedp(quests[wiz]) || quests[wiz]=="nothing" )
				class3 += "("HIW+"暂无任务"+NOR")\t\t\t";
				else if( strlen(quests[wiz])<31 )
				    class3 += "("YEL+quests[wiz]+NOR")\t\t\t";
				else class3 += "("YEL+quests[wiz]+NOR")\t\t";
				break;
				
				default:
				c4++;
				count++;
				if( objectp(ob=find_player(wiz)) && me->visible(ob) )
                                        if(!ob->query("env/invisibility"))
							class4 += ((c4-1)%2?"":"\n")+HIG+wiz+NOR;
						else
							class4 += ((c4-1)%2?"":"\n")+HIY+wiz+NOR;
				else
				class4 += ((c4-1)%2?"":"\n")+WHT+wiz+NOR;
				
				if( undefinedp(quests[wiz]) || quests[wiz]=="nothing" )
				class4 += "("HIW+"暂无任务"+NOR")\t\t\t";
				else if( strlen(quests[wiz])<31 )
				    class4 += "("YEL+quests[wiz]+HIG")\t\t\t";
				else class4 += "("YEL+quests[wiz]+HIG")\t\t";
				break;
				}
				}
				}
}	
write(HIY"\n"NOR"━━━━━━━━━━━━━【"HBRED" 管理部 "NOR+"】━━━━━━━━━━━━━━"HIY"\n"NOR);
if( strlen(class1)>10 )
write(class1);
write(HIY"\n"NOR"━━━━━━━━━━━━━【"HBMAG" 开发部 "NOR+"】━━━━━━━━━━━━━━"HIY"\n"NOR);
if( strlen(class2)>10 )
write(class2);
write(HIY"\n"NOR"━━━━━━━━━━━━━【"HBCYN" 玩家部 "NOR+"】━━━━━━━━━━━━━━"HIY"\n"NOR);
if( strlen(class3)>10 )
write(class3);
write(HIY"\n"NOR"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"HIY"\n"NOR);
write(CYN"管理部神仙负责维护秩序，开发部神仙每天一个小时收集 BUG 资料，\n玩家部神仙整理玩家对游戏的建议与意见。\n"NOR);
write("其中"HIG"亮绿色"NOR"的表示在线。\n\n\n");

return 1;

}
int help(object me)
{
write(@HELP
指令格式 : wizlist

用途 : 列出目前所有的巫师名单。
HELP
     );
     return 1;
}